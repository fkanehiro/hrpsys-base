<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Basic RT components and utilities: $title</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Basic RT components and utilities
   &#160;<span id="projectnumber">315.12.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="introduction"></a>
Overview</h2>
<p>This component is generate walking pattern and control Center Of Gravity (COG) for legged robots without sensor feedback.</p>
<h3><a class="anchor" id="cog"></a>
COG control</h3>
<p>This component modifies input joint angles to track reference COG position. This component receives reference joint angles from "qRef" inport. Then it solves Inverse Kinematics (or something) to track reference COG position, obtains jonint angles, and outputs the joint angles as "q" outport.</p>
<p>In this calculation, this component tracks reference XY COG position, reference Z base position, and reference base orientation.</p>
<h3><a class="anchor" id="mode"></a>
Mode</h3>
<p>This component has modes and behaves as Finite State Machine. By default, this component is idle mode ("MODE_IDLE"), in which it do not modify input joint angles. When <a class="el" href="../../d4/d5b/interfaceOpenHRP_1_1AutoBalancerService.html#a64c4d4663874a9b36c75ca46c6ba3994" title="Start AutoBalancer mode in which the robot controls the COM.">OpenHRP::AutoBalancerService::startAutoBalancer()</a> are called in IDLE mode, it switches to controlling mode ("MODE_ABC"), in which it modifies joint angles. When <a class="el" href="../../d4/d5b/interfaceOpenHRP_1_1AutoBalancerService.html#ad36bf04c5a607f39fb58fae1922c222c" title="Stop AutoBalancer mode.">OpenHRP::AutoBalancerService::stopAutoBalancer()</a> are called in controlling mode, it switches to idle mode.</p>
<h3><a class="anchor" id="eef"></a>
Controlled end-effectors</h3>
<p>User can specify which end-effector is controlled by the argument of <a class="el" href="../../d4/d5b/interfaceOpenHRP_1_1AutoBalancerService.html#a64c4d4663874a9b36c75ca46c6ba3994" title="Start AutoBalancer mode in which the robot controls the COM.">OpenHRP::AutoBalancerService::startAutoBalancer()</a>. When <a class="el" href="../../d4/d5b/interfaceOpenHRP_1_1AutoBalancerService.html#a64c4d4663874a9b36c75ca46c6ba3994" title="Start AutoBalancer mode in which the robot controls the COM.">OpenHRP::AutoBalancerService::startAutoBalancer()</a> are called with ["rleg", "lleg"], it controlles reference end-effector position and orientation for "rleg" and "lleg". When <a class="el" href="../../d4/d5b/interfaceOpenHRP_1_1AutoBalancerService.html#a64c4d4663874a9b36c75ca46c6ba3994" title="Start AutoBalancer mode in which the robot controls the COM.">OpenHRP::AutoBalancerService::startAutoBalancer()</a> are called with ["rleg", "lleg", "rarm", "larm"], it controlles reference end-effector for "rleg", "lleg", "rarm", "larm". In this case, the robot seems to keep both feet and hands position and orientation.</p>
<h3><a class="anchor" id="wpg"></a>
Walking pattern generation</h3>
<p>This component has also the feature as walking pattern generation, named as GaitGenerator. When <a class="el" href="../../d4/d5b/interfaceOpenHRP_1_1AutoBalancerService.html#ab1228769703a5a8403f80f34c4f96010" title="Walk to the goal position and orientation.">OpenHRP::AutoBalancerService::goPos()</a>, <a class="el" href="../../d4/d5b/interfaceOpenHRP_1_1AutoBalancerService.html#ad76d7a7c8aff5c0fa95c16b267929bcd" title="Walk at the desired velocity.">OpenHRP::AutoBalancerService::goVelocity()</a>, <a class="el" href="../../d4/d5b/interfaceOpenHRP_1_1AutoBalancerService.html#ae851b93be61d42b45f37a24d34affb21" title="Set footsteps.">OpenHRP::AutoBalancerService::setFootSteps()</a> are called, this component starts to use reference XY COG position from "GaitGenerator". For <a class="el" href="../../d4/d5b/interfaceOpenHRP_1_1AutoBalancerService.html#ab1228769703a5a8403f80f34c4f96010" title="Walk to the goal position and orientation.">OpenHRP::AutoBalancerService::goPos()</a> and <a class="el" href="../../d4/d5b/interfaceOpenHRP_1_1AutoBalancerService.html#ae851b93be61d42b45f37a24d34affb21" title="Set footsteps.">OpenHRP::AutoBalancerService::setFootSteps()</a>, this component stops to use it after completing walking command. After <a class="el" href="../../d4/d5b/interfaceOpenHRP_1_1AutoBalancerService.html#ad76d7a7c8aff5c0fa95c16b267929bcd" title="Walk at the desired velocity.">OpenHRP::AutoBalancerService::goVelocity()</a> is called, this component continuously generates walking pattern. When <a class="el" href="../../d4/d5b/interfaceOpenHRP_1_1AutoBalancerService.html#a5b1b21542295ce1dc9dfc9493677cf79" title="Stop stepping.">OpenHRP::AutoBalancerService::goStop()</a> are called in this case, this completing stops to use it after completing walking command.</p>
<h3><a class="anchor" id="pcexample"></a>
Preview Controller Example</h3>
<p>Preview controller example, in which trajectories are displayed on graphs (COG, ZMP, ... etc).</p>
<div class="fragment"><pre class="fragment">testPreviewController # Non-ROS environemnt
rosrun hrpsys testPreviewController # ROS environemnt
</pre></div><h3><a class="anchor" id="ggexample"></a>
GaitGenerator Example</h3>
<p>GaitGenerator example, in which trajectories are displayed on graphs (COG, ZMP, foot trajectories ... etc).</p>
<p>Users can change test type (fwd-walking example, rotation-walking example, stair-walking, toe-heel example, ... etc).</p>
<p>Users can also change GaitGenerator parameters (step time, step height, orbit type, ... etc).</p>
<div class="fragment"><pre class="fragment">testGaitGenerator [test-type-<a class="code" href="../../dd/d9e/rtc_2KalmanFilter_2CMakeLists_8txt.html#a5abe185187eaa0f3ba17f63a50fac974">option</a>] [gg-parameters-options] # Non ROS environment
rosrun hrpsys testGaitGenerator [test-type-<a class="code" href="../../dd/d9e/rtc_2KalmanFilter_2CMakeLists_8txt.html#a5abe185187eaa0f3ba17f63a50fac974">option</a>] [gg-parameters-options] # ROS environment
</pre></div><p> [test-type-option] is test type and [gg-parameters-options] are GaitGeneratorParameters. To learn test type, please execute testGaitGenerator without arguments.</p>
<h3><a class="anchor" id="moreabcggdocument"></a>
More Documentation, Figures, and Explanation for AutoBalancer and GaitGenerator</h3>
<p><a href="https://github.com/fkanehiro/hrpsys-base/raw/master/rtc/AutoBalancer/hrpsys_AutoBalancer_GaitGenerator_memo.pptx">AutoBalancerGaitGeneratorDocumentationSlide</a></p>
<table class="doxtable">
<tr>
<th>implementation_id</th><td>AutoBalancer </td></tr>
<tr>
<th>category</th><td>example </td></tr>
</table>
<h3><a class="anchor" id="toejoint"></a>
About Toe Joints</h3>
<p>AutoBalancer can support toe joints. Toe joint is defined as end-link joint in the case that end-effector link != force-sensor link. Without toe joints, "end-effector link == force-sensor link" is assumed. With toe joints, "end-effector link != force-sensor link" is assumed.</p>
<h3><a class="anchor" id="handfunc"></a>
Hands and arms functionality</h3>
<p>In AutoBalancer, hands and arms has several functionality for two legs and two arms robot. 1. No ik mode. If startAutoBalancer with ["rleg", "lleg"], arms IK are not solved while MODE_ABC.</p>
<p>2. IK mode without fix. If startAutoBalancer with ["rleg", "lleg", "rarm", "larm"] and leg_names is ["rleg", "lleg"] and is_hand_fix_mode is false, arms IK are solved while MODE_ABC and Hands target pos are determined according to COG velocity during walking. So, hands seems to follow upper body swinging and total behavior looks like No IK mode.</p>
<p>3. IK mode with fix. If startAutoBalancer with ["rleg", "lleg", "rarm", "larm"] and leg_names is ["rleg", "lleg"] and is_hand_fix_mode is true, arms IK are solved while MODE_ABC. Hands target pos Y in foot coords are not change during walking and pos X in foot coords is determined according to COG velocity X. So, hands seems to be fixed and follow foot projected coordinated.</p>
<p>4. Four legged walking mode. If startAutoBalancer with ["rleg", "lleg", "rarm", "larm"] and leg_names is ["rleg", "lleg", "rarm", "larm"], arms IK are solved while MODE_ABC and hand coords are determined by GaitGenerator as walking target.</p>
<h2><a class="anchor" id="dataports"></a>
Data Ports</h2>
<h3><a class="anchor" id="inports"></a>
Input Ports</h3>
<table class="doxtable">
<tr>
<th>port name</th><th>data type</th><th>unit</th><th>description </th></tr>
<tr>
<td>qRef</td><td>RTC::TimedDoubleSeq</td><td>[rad]</td><td>Reference joint angles </td></tr>
<tr>
<td>zmpIn</td><td>RTC::TimedPoint3D</td><td>[m]</td><td>Input ZMP in base frame </td></tr>
<tr>
<td>basePosIn</td><td>RTC::TimedPoint3D</td><td>[m]</td><td>Input base position </td></tr>
<tr>
<td>baseRpyIn</td><td>RTC::TimedOrientation3D</td><td>[rad]</td><td>Input base orientation (RPY) </td></tr>
</table>
<h3><a class="anchor" id="outports"></a>
Output Ports</h3>
<table class="doxtable">
<tr>
<th>port name</th><th>data type</th><th>unit</th><th>description </th></tr>
<tr>
<td>q</td><td>RTC::TimedDoubleSeq</td><td>[rad]</td><td>Output reference joint angles </td></tr>
<tr>
<td>zmpOut</td><td>RTC::TimedPoint3D</td><td>[m]</td><td>Output ZMP in base frame </td></tr>
<tr>
<td>basePosOut</td><td>RTC::TimedPoint3D</td><td>[m]</td><td>Output base position </td></tr>
<tr>
<td>baseRpyOut</td><td>RTC::TimedOrientation3D</td><td>[rad]</td><td>Output base orientation (RPY) </td></tr>
<tr>
<td>baseTformOut</td><td>RTC::TimedDoubleSeq</td><td>[m], [rad]</td><td>Output base position and orientation (RPY) </td></tr>
<tr>
<td>accRef</td><td>RTC::TimedAcceleration3D</td><td>[m/s^2]</td><td>Output attitude sensor's acceleration </td></tr>
<tr>
<td>contactStates</td><td>RTC::TimedBooleanSeq</td><td>NA</td><td>Reference end-effector contact states (True=contact, False=no-contact) </td></tr>
<tr>
<td>controlSwingSupportTime</td><td>RTC::TimedDouble</td><td>[s]</td><td>Time of swing phase </td></tr>
</table>
<h2><a class="anchor" id="serviceports"></a>
Service Ports</h2>
<h3><a class="anchor" id="provider"></a>
Service Providers</h3>
<table class="doxtable">
<tr>
<th>port name</th><th>interface name</th><th>service type</th><th>IDL</th><th>description </th></tr>
<tr>
<td>AutoBalancerService</td><td>service0</td><td>AutoBalancerService</td><td><a class="el" href="../../d4/d5b/interfaceOpenHRP_1_1AutoBalancerService.html">OpenHRP::AutoBalancerService</a></td><td>AutoBalancerService </td></tr>
</table>
<h3><a class="anchor" id="consumer"></a>
Service Consumers</h3>
<p>N/A</p>
<h2><a class="anchor" id="configuration"></a>
Configuration Variables</h2>
<table class="doxtable">
<tr>
<th>name</th><th>type</th><th>unit</th><th>default value</th><th>description </th></tr>
<tr>
<td>debugLevel</td><td>int</td><td></td><td>0</td><td>debug level </td></tr>
</table>
<h2><a class="anchor" id="conf"></a>
Configuration File</h2>
<p>N/A </p>
</div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Tue May 2 2017 07:41:46 for Basic RT components and utilities by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
